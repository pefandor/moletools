---
import Layout from '../../layouts/Layout.astro';
import FAQ from '../../components/FAQ.astro';
import toolsData from '../../data/tools.json';

const tool = toolsData.find(t => t.id === 'uuid')!;

const jsonLd = {
  '@context': 'https://schema.org',
  '@type': 'WebApplication',
  name: tool.name,
  description: tool.description,
  applicationCategory: 'DeveloperApplication',
  operatingSystem: 'Any',
  offers: {
    '@type': 'Offer',
    price: '0',
    priceCurrency: 'USD'
  },
  browserRequirements: 'Requires JavaScript',
  permissions: 'No special permissions required'
};

const faqJsonLd = {
  '@context': 'https://schema.org',
  '@type': 'FAQPage',
  mainEntity: tool.faq.map(item => ({
    '@type': 'Question',
    name: item.question,
    acceptedAnswer: {
      '@type': 'Answer',
      text: item.answer
    }
  }))
};
---

<Layout title={tool.metaTitle} description={tool.metaDescription}>
  <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
  <script type="application/ld+json" set:html={JSON.stringify(faqJsonLd)} />
  <div class="max-w-4xl mx-auto">
    <div class="mb-6">
      <h1 class="text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2">ðŸŽ² UUID Generator</h1>
      <p class="text-gray-600 dark:text-gray-400">Generate random UUIDs (v4)</p>
    </div>

    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6 space-y-4">
      <!-- Controls -->
      <div class="flex items-center space-x-4 flex-wrap gap-2">
        <label class="flex items-center space-x-2">
          <span class="text-sm text-gray-700 dark:text-gray-300">Count:</span>
          <input
            type="number"
            id="count"
            value="1"
            min="1"
            max="100"
            class="w-20 px-2 py-1 border border-gray-300 dark:border-gray-600 rounded dark:bg-gray-700 dark:text-gray-100"
          />
        </label>

        <label class="flex items-center space-x-2">
          <input type="checkbox" id="uppercase" class="rounded" />
          <span class="text-sm text-gray-700 dark:text-gray-300">Uppercase</span>
        </label>

        <label class="flex items-center space-x-2">
          <input type="checkbox" id="noDashes" class="rounded" />
          <span class="text-sm text-gray-700 dark:text-gray-300">Remove dashes</span>
        </label>

        <button
          id="generateBtn"
          class="px-4 py-2 bg-primary-600 dark:bg-primary-500 text-white rounded-lg hover:bg-primary-700 transition-colors"
        >
          Generate
        </button>

        <button
          id="copyBtn"
          class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
        >
          Copy All
        </button>
      </div>

      <!-- Output -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Generated UUIDs</label>
        <textarea
          id="output"
          rows="15"
          readonly
          class="w-full px-3 py-2 border border-gray-300 rounded-lg font-mono text-sm bg-gray-50 dark:bg-gray-700 focus:ring-2 focus:ring-primary-500"
        ></textarea>
      </div>

      <!-- Stats -->
      <div class="text-sm text-gray-600 dark:text-gray-400">
        <p><strong>Format:</strong> UUID v4 (Random)</p>
        <p><strong>Example:</strong> <code class="bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded">550e8400-e29b-41d4-a716-446655440000</code></p>
      </div>
    </div>

    <!-- FAQ Section -->
    <FAQ items={tool.faq} />
  </div>
</Layout>

<script>
  const generateBtn = document.getElementById('generateBtn');
  const copyBtn = document.getElementById('copyBtn');
  const countInput = document.getElementById('count');
  const uppercaseCheckbox = document.getElementById('uppercase');
  const noDashesCheckbox = document.getElementById('noDashes');
  const output = document.getElementById('output');

  function generateUUID() {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
      const r = Math.random() * 16 | 0;
      const v = c === 'x' ? r : (r & 0x3 | 0x8);
      return v.toString(16);
    });
  }

  function formatUUID(uuid) {
    let formatted = uuid;

    if (noDashesCheckbox?.checked) {
      formatted = formatted.replace(/-/g, '');
    }

    if (uppercaseCheckbox?.checked) {
      formatted = formatted.toUpperCase();
    }

    return formatted;
  }

  function generateUUIDs() {
    const count = parseInt(countInput?.value || '1');
    const uuids: string[] = [];

    for (let i = 0; i < Math.min(count, 100); i++) {
      uuids.push(formatUUID(generateUUID()));
    }

    output.value = uuids.join('\n');
  }

  // Generate on load
  generateUUIDs();

  generateBtn?.addEventListener('click', generateUUIDs);

  // Regenerate when options change
  uppercaseCheckbox?.addEventListener('change', generateUUIDs);
  noDashesCheckbox?.addEventListener('change', generateUUIDs);
  countInput?.addEventListener('change', generateUUIDs);

  copyBtn?.addEventListener('click', async () => {
    try {
      await navigator.clipboard.writeText(output.value);
      const originalText = copyBtn.textContent;
      copyBtn.textContent = 'Copied!';
      setTimeout(() => {
        copyBtn.textContent = originalText;
      }, 2000);
    } catch (error) {
      console.error('Failed to copy');
    }
  });
</script>
